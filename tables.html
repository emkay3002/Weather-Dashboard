<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Dashboard - Tables</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="main-dashboard.css" />
</head>

<body class="bg-gray-100">
    <header class="bg-teal-800 text-white py-3 px-5 flex justify-between items-center">
        <div class="flex items-center gap-2 text-xl font-bold">
            <img src="assets/logo1.png" class="w-10 h-10 object-contain" alt="Logo" />
            <span>Stormly</span>
        </div>
        <nav class="flex items-center gap-4">
            <ul class="flex items-center gap-4">
                <li class="relative">
                    <a href="#" id="nav-language-setting"
                        class="flex items-center text-white hover:bg-teal-700 px-3 py-2 rounded-md">
                        <span id="selected-language">English</span>
                        <img id="language-icon" src="assets/usa.png" alt="Flag" class="ml-2 w-5 h-4 object-contain" />
                    </a>
                    <ul class="hidden absolute bg-teal-800 top-full left-0 min-w-[120px] rounded-md shadow-lg z-10 mt-2"
                        id="language-dropdown">
                        <li>
                            <a href="#" data-language="English" data-icon="assets/usa.png"
                                class="flex items-center text-white px-4 py-2 hover:bg-teal-700 rounded-md">
                                <img src="assets/usa.png" alt="English" class="w-5 h-4 mr-2" />English
                            </a>
                        </li>
                        <li>
                            <a href="#" data-language="Arabic" data-icon="assets/ksa.png"
                                class="flex items-center text-white px-4 py-2 hover:bg-teal-700 rounded-md">
                                <img src="assets/ksa.png" alt="Arabic" class="w-5 h-4 mr-2" />Arabic
                            </a>
                        </li>
                        <li>
                            <a href="#" data-language="Turkish" data-icon="assets/turkey.png"
                                class="flex items-center text-white px-4 py-2 hover:bg-teal-700 rounded-md">
                                <img src="assets/turkey.png" alt="Turkish" class="w-5 h-4 mr-2" />Turkish
                            </a>
                        </li>
                        <li>
                            <a href="#" data-language="German" data-icon="assets/germany.png"
                                class="flex items-center text-white px-4 py-2 hover:bg-teal-700 rounded-md">
                                <img src="assets/germany.png" alt="German" class="w-5 h-4 mr-2" />German
                            </a>
                        </li>
                        <li>
                            <a href="#" data-language="Chinese" data-icon="assets/china.png"
                                class="flex items-center text-white px-4 py-2 hover:bg-teal-700 rounded-md">
                                <img src="assets/china.png" alt="Chinese" class="w-5 h-4 mr-2" />Chinese
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="flex items-center">
                    <img src="assets/pfp.png" alt="Profile"
                        class="w-10 h-10 rounded-full object-cover cursor-pointer" />
                </li>
            </ul>
        </nav>
    </header>
    <div class="flex h-[calc(100vh-56px)]">
        <aside class="bg-teal-900 text-gray-300 w-52 p-5">
            <ul class="space-y-2">
                <li>
                    <a href="main-dashboard.html" id="menu-dashboard"
                        class="block text-gray-300 hover:bg-teal-700 px-4 py-2 rounded-md">Dashboard</a>
                </li>
                <li>
                    <a href="tables.html" id="menu-tables"
                        class="block text-gray-300 hover:bg-teal-700 px-4 py-2 rounded-md">Tables</a>
                </li>
            </ul>
        </aside>
        <main class="flex-grow p-5 bg-white overflow-y-auto flex">
            <div class="w-2/3">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold">5-Day Temperature Forecast</h2>
                    <input type="text" id="city-search" placeholder="Search city..."
                        class="border border-gray-300 rounded-md px-2 py-1" />
                    <button id="search-button" class="bg-teal-700 text-white px-4 py-1 rounded-md ml-2">
                        Search
                    </button>
                </div>
                <table id="forecast-table" class="min-w-full border-collapse border border-gray-200">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="border border-gray-300 p-2">Day</th>
                            <th class="border border-gray-300 p-2">Date</th>
                            <th class="border border-gray-300 p-2">Time</th>
                            <th class="border border-gray-300 p-2 temp-column">Temperature (°C)</th>
                            <th class="border border-gray-300 p-2">Weather Icon</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Forecast data will be inserted here -->
                    </tbody>
                </table>
                <div id="pagination" class="flex justify-center mt-4"></div>
            </div>
            <div class="w-1/3 pl-4">
                <div class="bg-gray-100 p-4 rounded shadow">
                    <h3 class="text-lg font-bold">Additional Info</h3>
                    <p>This area can hold additional content like charts or summaries.</p>
                </div>
            </div>
        </main>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const apiKey = "e87ad9d755ad6ee678f1952e3c13a8e1";
            const tableBody = document.getElementById("table-body");
            const pagination = document.getElementById("pagination");
            const searchInput = document.getElementById("city-search"); // Get the search input
            const searchButton = document.getElementById("search-button"); // Get the search button
            let forecastData = [];
            const entriesPerPage = 10;

            // Default city
            let city = "London";

            // Fetch weather forecast data for the next 5 days
            async function fetchForecast(city) {
                try {
                    console.log(`Fetching forecast for: ${city}`); // Debug log
                    const response = await fetch(
                        `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`
                    );
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    console.log("Fetched data:", data); // Debug log
                    if (data.list && data.list.length > 0) {
                        processForecastData(data.list);
                    } else {
                        console.error("No forecast data found");
                        alert("No forecast data available for this city.");
                    }
                } catch (error) {
                    console.error("Error fetching forecast:", error);
                    alert(
                        "Failed to fetch forecast data. Please check your city name or API key."
                    );
                }
            }

            // Process the forecast data and store it in forecastData
            function processForecastData(data) {
                const dailyTemperatures = {}; // Reset for each fetch

                // Gather temperatures and weather conditions for each day and time
                data.forEach((entry) => {
                    const date = new Date(entry.dt * 1000);
                    const dayName = date.toLocaleString("en-US", { weekday: "long" });
                    const dateKey = date.toISOString().split("T")[0]; // Key by date

                    if (!dailyTemperatures[dateKey]) {
                        dailyTemperatures[dateKey] = { day: dayName, temps: [] };
                    }
                    dailyTemperatures[dateKey].temps.push({
                        time: date.toLocaleTimeString([], {
                            hour: "2-digit",
                            minute: "2-digit",
                        }),
                        temp: entry.main.temp,
                        icon: entry.weather[0].icon, // Get the weather icon code
                    });
                });

                // Flatten data to create entries for each temperature reading
                forecastData = [];
                for (const [date, { day, temps }] of Object.entries(dailyTemperatures)) {
                    temps.forEach(({ time, temp, icon }) => {
                        forecastData.push({
                            date,
                            day,
                            time,
                            temperature: temp.toFixed(1), // Store formatted temperature
                            icon, // Store the icon code
                        });
                    });
                }

                renderTable(); // Render the first page of the table
                renderPagination(); // Render pagination controls
            }

            // Render the forecast data into the table
            function renderTable(page = 1) {
                tableBody.innerHTML = "";
                const start = (page - 1) * entriesPerPage;
                const end = start + entriesPerPage;

                const dataToDisplay = forecastData.slice(start, end);
                dataToDisplay.forEach((item) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td class="border border-gray-300 p-2">${item.day}</td>
                        <td class="border border-gray-300 p-2">${item.date}</td>
                        <td class="border border-gray-300 p-2">${item.time}</td>
                        <td class="border border-gray-300 p-2 temp-column">${item.temperature} °C</td>
                        <td class="border border-gray-300 p-2"><img src="https://openweathermap.org/img/wn/${item.icon}@2x.png" alt="Weather Icon" class="w-8 h-8" /></td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            // Render pagination buttons
            function renderPagination() {
                pagination.innerHTML = "";
                const pageCount = Math.ceil(forecastData.length / entriesPerPage);

                for (let i = 1; i <= pageCount; i++) {
                    const button = document.createElement("button");
                    button.textContent = i;
                    button.className =
                        "border border-gray-300 px-4 py-2 mx-1 hover:bg-gray-200";
                    button.addEventListener("click", () => {
                        renderTable(i);
                    });
                    pagination.appendChild(button);
                }
            }

            // Handle search
            searchButton.addEventListener("click", () => {
                city = searchInput.value.trim(); // Get the value from the input
                if (city) {
                    fetchForecast(city); // Fetch the weather forecast for the searched city
                } else {
                    alert("Please enter a city name.");
                }
            });

            // Fetch the forecast for the default city when the page loads
            fetchForecast(city);
        });
    </script>
</body>

</html>